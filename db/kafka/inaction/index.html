
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Qiu(aschenmaker)">
      
      
        <link rel="canonical" href="https://docs.cqs.es/db/kafka/inaction/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.3">
    
    
      
        <title>快速kafka摘要 - Qiu's doc space</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.62128196.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,400,400i,700%7CFira+Mono&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}</style>
      
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../../..":"../../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kafka-in-action" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Qiu&#39;s doc space" class="md-header__button md-logo" aria-label="Qiu's doc space" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Qiu's doc space
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              快速kafka摘要
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aschenmaker/docs/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aschenmaker/docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      首页
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../cs/opsys/op/" class="md-tabs__link">
        基础&理论
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../algo/sort/sort/" class="md-tabs__link">
        算法&数据结构
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../pl/golang/memesacape/" class="md-tabs__link">
        编程语言
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../k8s/install/" class="md-tabs__link md-tabs__link--active">
        组件
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../translate/tp1/" class="md-tabs__link">
        litte blog
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../maybe/maybe/" class="md-tabs__link">
        或许你也需要这样的站点
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Qiu&#39;s doc space" class="md-nav__button md-logo" aria-label="Qiu's doc space" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"/></svg>

    </a>
    Qiu's doc space
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aschenmaker/docs/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aschenmaker/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        首页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          基础&理论
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="基础&理论" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          基础&理论
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/opsys/op/" class="md-nav__link">
        操作系统
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          计算机网络
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="计算机网络" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          计算机网络
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/network/tcp/" class="md-nav__link">
        TCP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/linux/linux/" class="md-nav__link">
        linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          分布式
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="分布式" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          分布式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/distributed/cap/" class="md-nav__link">
        CAP理论
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cs/distributed/alo/" class="md-nav__link">
        分布式一致性算法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          算法&数据结构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="算法&数据结构" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          算法&数据结构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          算法
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="算法" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          算法
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algo/sort/sort/" class="md-nav__link">
        排序
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          数据结构
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="数据结构" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          数据结构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../algo/alg/heap/" class="md-nav__link">
        堆以及用go实现
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          编程语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编程语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Golang
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Golang" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Golang
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/golang/memesacape/" class="md-nav__link">
        内存逃逸
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/golang/gmp/" class="md-nav__link">
        gmp状态详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/golang/struct-align/" class="md-nav__link">
        Golang内存对齐
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Golang的底层实现
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Golang的底层实现" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Golang的底层实现
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/golang-imp/interface/" class="md-nav__link">
        interface的实现
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/golang-imp/gmp/" class="md-nav__link">
        gmp代码解释
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          组件
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="组件" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          组件
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../k8s/install/" class="md-nav__link">
        在实验室安装Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          mysql
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="mysql" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          mysql
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/innodb-lock/" class="md-nav__link">
        Innodb中事务隔离级别和锁的关系
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/mysql/" class="md-nav__link">
        快速mysql摘要
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          redis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="redis" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/lock/" class="md-nav__link">
        Redis实现分布式锁锁
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          kafka
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="kafka" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          kafka
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          快速kafka摘要
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        快速kafka摘要
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1异步通信
  </a>
  
    <nav class="md-nav" aria-label="1异步通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1观察者模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2生产者消费者模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3消息中间件的作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4数据单元
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2消息传递原理
  </a>
  
    <nav class="md-nav" aria-label="2消息传递原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1点对点传递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2发布订阅消息传递
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3kafka" class="md-nav__link">
    3kafka
  </a>
  
    <nav class="md-nav" aria-label="3kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1设计目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2优点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4kafka" class="md-nav__link">
    4kafka系统架构
  </a>
  
    <nav class="md-nav" aria-label="4kafka系统架构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41broker" class="md-nav__link">
    4.1broker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42topic" class="md-nav__link">
    4.2topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43partition" class="md-nav__link">
    4.3partition 分区
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44leader" class="md-nav__link">
    4.4leader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45follower" class="md-nav__link">
    4.5follower
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46replication" class="md-nav__link">
    4.6replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47producer" class="md-nav__link">
    4.7producer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48consumer" class="md-nav__link">
    4.8consumer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49consumer-group" class="md-nav__link">
    4.9consumer group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#410offset" class="md-nav__link">
    4.10offset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#411zookeeper" class="md-nav__link">
    4.11zookeeper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5数据检索机制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6数据安全性
  </a>
  
    <nav class="md-nav" aria-label="6数据安全性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61producer-deliver-guarantee" class="md-nav__link">
    6.1Producer deliver guarantee
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-isr-in-sync-replica" class="md-nav__link">
    6.2 ISR机制 In Sync Replica
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63broker" class="md-nav__link">
    6.3Broker数据存储机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64" class="md-nav__link">
    6.4消费者数据消费保证
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7kafka" class="md-nav__link">
    7kafka优化
  </a>
  
    <nav class="md-nav" aria-label="7kafka优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71partition" class="md-nav__link">
    7.1partition数目
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72replication-factor" class="md-nav__link">
    7.2replication factor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3批量写入
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          litte blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="litte blog" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          litte blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          翻译计划
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="翻译计划" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          翻译计划
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/tp1/" class="md-nav__link">
        通过漫画-认识Kubernete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/tp2/" class="md-nav__link">
        Shazam是如何工作的
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/tp3/" class="md-nav__link">
        使用golang处理百万请求
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          somethings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="somethings" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          somethings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/sharing/mac-app/" class="md-nav__link">
        我在mac下用什么
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="other" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../translate/re/fsm-1/" class="md-nav__link">
        从if-else地狱到状态机流转
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          或许你也需要这样的站点
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="或许你也需要这样的站点" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          或许你也需要这样的站点
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../maybe/maybe/" class="md-nav__link">
        十分钟快速创建mkdocs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../maybe/tocos/" class="md-nav__link">
        使用腾讯云COS部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../maybe/webify/" class="md-nav__link">
        使用腾讯云Webify进行部署
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1异步通信
  </a>
  
    <nav class="md-nav" aria-label="1异步通信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1观察者模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2生产者消费者模式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3消息中间件的作用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14" class="md-nav__link">
    1.4数据单元
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2消息传递原理
  </a>
  
    <nav class="md-nav" aria-label="2消息传递原理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1点对点传递
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2发布订阅消息传递
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3kafka" class="md-nav__link">
    3kafka
  </a>
  
    <nav class="md-nav" aria-label="3kafka">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1设计目标
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2优点
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4kafka" class="md-nav__link">
    4kafka系统架构
  </a>
  
    <nav class="md-nav" aria-label="4kafka系统架构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41broker" class="md-nav__link">
    4.1broker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42topic" class="md-nav__link">
    4.2topic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43partition" class="md-nav__link">
    4.3partition 分区
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44leader" class="md-nav__link">
    4.4leader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45follower" class="md-nav__link">
    4.5follower
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46replication" class="md-nav__link">
    4.6replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47producer" class="md-nav__link">
    4.7producer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48consumer" class="md-nav__link">
    4.8consumer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49consumer-group" class="md-nav__link">
    4.9consumer group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#410offset" class="md-nav__link">
    4.10offset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#411zookeeper" class="md-nav__link">
    4.11zookeeper
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5数据检索机制
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6数据安全性
  </a>
  
    <nav class="md-nav" aria-label="6数据安全性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61producer-deliver-guarantee" class="md-nav__link">
    6.1Producer deliver guarantee
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-isr-in-sync-replica" class="md-nav__link">
    6.2 ISR机制 In Sync Replica
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63broker" class="md-nav__link">
    6.3Broker数据存储机制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64" class="md-nav__link">
    6.4消费者数据消费保证
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7kafka" class="md-nav__link">
    7kafka优化
  </a>
  
    <nav class="md-nav" aria-label="7kafka优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71partition" class="md-nav__link">
    7.1partition数目
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72replication-factor" class="md-nav__link">
    7.2replication factor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3批量写入
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/aschenmaker/docs/blob/master/docs/db/kafka/inaction.md" title="编辑此页" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="kafka-in-action">kafka in action</h1>
<h2 id="1">1异步通信</h2>
<h3 id="11">1.1观察者模式</h3>
<p><strong>发布-订阅模式</strong></p>
<p>定义一种一对多的关系，如果一个对象改变了状态，那么依赖他的对象都会得到通知和自动更新</p>
<h3 id="12">1.2生产者消费者模式</h3>
<ul>
<li><strong>传统模式</strong>  </li>
<li>生产者直接讲消息传递给指定的消费者</li>
<li>耦合性较高，生产者和消费者逻辑产生了变化都需要修改业务逻辑</li>
<li>生产者和消费者的不一定是 1:1 的生产消费的配比</li>
<li><strong>引入消息中间件</strong></li>
<li>通过一个中间的阻塞队列来进行通讯，实现解耦<ul>
<li>生产者 ---&gt; 消息中间件 &rarr; 消费者</li>
</ul>
</li>
<li>数据传递流程</li>
<li>可以N个生产者，也可以有N个消费者</li>
<li>生产者向中间件中添加数据</li>
<li>消费者从中间件取出数据， 一般情况下先进先出FIFO的原则</li>
</ul>
<h3 id="13">1.3消息中间件的作用</h3>
<ul>
<li>解耦</li>
<li>支持并发</li>
<li>生产者可以持续进行生产</li>
<li>削峰</li>
<li>高峰期产生的数据可以进行挤压</li>
</ul>
<h3 id="14">1.4数据单元</h3>
<ul>
<li>关联到业务对象</li>
<li>数据单元必须关联到某一种数据对象</li>
<li>完整性</li>
<li>传输过程中需要保证数据的完整性</li>
<li>独立性</li>
<li>数据单元之间没有相互的依赖</li>
<li>某个数据单元没有传输完成，不会影响到其他的数据单元</li>
<li>颗粒度</li>
<li>颗粒度过小，传输的次数变多</li>
<li>颗粒度过大增加了传输的时间，以及后期消费速度</li>
</ul>
<h2 id="2">2消息传递原理</h2>
<p>消息传递系统负责将数据从一个应用传递到另外一个应用，应用只需要关注数据，无需关注数据在两个和多个应用中是如何传递的。</p>
<h3 id="21">2.1点对点传递</h3>
<ul>
<li>消息持久化道一个队列中，有一个或者多个消费者消费队列的数据。但是只能被消费一次。</li>
<li>某条数据被消费后应该从队列中删除</li>
<li>即使有多个消费者，也需要保证数据的顺序处理</li>
<li>在这种模式中由 <code>消费代理</code> 来记录消费状态， 但是这种模式无法很好保证消费的处理语义，他是不是真的成功被消费了？</li>
</ul>
<h3 id="22">2.2发布订阅消息传递</h3>
<ul>
<li>消息被持久化道一个topic中</li>
<li>消费者可以订阅一种或多种topic，消费者可以消费topic的数据，同一条数据可以被多个消费者消费，数据消费后也不会立马删除</li>
<li>被多个消费者消费，可以理解为消息需要作用多个应用中去。</li>
<li>kafka采用 <code>拉取模型</code>， 由消费者控制消费速度，和消费的进度，消费者可以按照任意格式的偏移量进行消费。</li>
</ul>
<h2 id="3kafka">3kafka</h2>
<p>kafka是一个高吞吐量的分布式消息发布订阅消息系统</p>
<h3 id="31">3.1设计目标</h3>
<ul>
<li>时间复杂度为O(1)的方式提供消息持久化的能力</li>
<li>高吞吐率</li>
<li>支持kafka server之间的消息分区，分布式消费，保证每一个partition内的消息顺序传输</li>
<li>支持在线水平扩展</li>
<li>同时支持离线数据处理和 <strong>实时数据</strong> 处理</li>
</ul>
<h3 id="32">3.2优点</h3>
<ul>
<li>解耦</li>
<li>冗余</li>
<li>持久化数据，直到被完全消费</li>
<li>拓展性</li>
<li>灵活性和峰值处理</li>
<li>可恢复行</li>
<li>顺序保证</li>
<li>缓冲</li>
</ul>
<h2 id="4kafka">4kafka系统架构</h2>
<p><img alt="kafka架构" src="https://dist.lyneee.com/blog/2021-09-24-kafka-arch.png" /></p>
<p><img alt="kafka2" src="https://dist.lyneee.com/blog/2021-09-24-kafka-arch2.jpg" /></p>
<h3 id="41broker">4.1broker</h3>
<p>kafka集群中包含一个或者多个服务器，每一个服务器节点叫做broker</p>
<h3 id="42topic">4.2topic</h3>
<ul>
<li>消息有不同的类别。被称为topic</li>
<li>类似于数据库中表名和ES的index</li>
<li>物理上不同的topic分开存储</li>
<li>逻辑上一个topic的消息虽然保存在一个或者多个broker上但是用户只需要指定消息的topic就可以进行消费</li>
</ul>
<h3 id="43partition">4.3partition 分区</h3>
<ul>
<li>一个topic中的数据分割为一个或者多个partition</li>
<li>生产者产生数据的时候，根据分配策略，选择分区，然后将消息追加到对应分区的尾端</li>
<li>每条消息都有自增的编号</li>
<li>标识顺序</li>
<li>标识消息的偏移量</li>
<li>每一个partition使用多个segment文件进行存储</li>
<li>单个partition中的数据是有序的</li>
<li>如果需要保证数据的完全顺序，那么需要讲partition设置为1</li>
</ul>
<h3 id="44leader">4.4leader</h3>
<p>每个partition有多个副本，其中一个作为leader，leader是当前负责数据读写的partition</p>
<h3 id="45follower">4.5follower</h3>
<ul>
<li>folloer跟随leader，所有写请求都通过leader路由，数据变更，都会广播给所有的follower，follower与leader保持一致</li>
<li>如果leader失效，则会从follower总选举产生一个新的leader</li>
<li>如果follower挂掉，卡住，或者同步太慢。leader会把这个follower从‘In sync replicas’（ISR）删除，重新创建一个新的follower</li>
</ul>
<h3 id="46replication">4.6replication</h3>
<ul>
<li>partition可能产生损坏</li>
<li>我们需要对分区数据进行备份</li>
<li>将分区划分为一个Leader和多个follower</li>
<li>leader负责写入和读取数据</li>
<li>follower负责备份数据</li>
<li>保证了数据的一致性</li>
<li>备份数，设置为N，则表示主+备=N</li>
</ul>
<h3 id="47producer">4.7producer</h3>
<ul>
<li>生产者讲消息发送到topic中</li>
<li>broker接收到生产者发送的消息后，将消息追加到用于追加数据的segment中</li>
<li>生产者发送的消息，存储到一个partition中，生产者可以指定数据存储的partition </li>
</ul>
<h3 id="48consumer">4.8consumer</h3>
<p>消费者可以从broker中读取数据，消费者可以消费多个topic中的数据</p>
<h3 id="49consumer-group">4.9consumer group</h3>
<ul>
<li>每一个consumer属于一个特定的consumer group</li>
<li>多个消费者集中处理某一个topic的数据，提高消费能力</li>
<li>整个消费者组共享一组偏移量，防止数据被重复读，因为一个topic有多个分区</li>
</ul>
<h3 id="410offset">4.10offset</h3>
<ul>
<li>可以唯一标识的一条数据</li>
<li>偏移量决定了数据读取的位置，不会有线程安全的问题，消费者通过偏移量来决定下次读取的位置</li>
<li>消息被消费之后，并不会立马删除，这样多个业务可以重复使用kafka的消息</li>
<li>可以修改偏移量达到重复读区的数据的目的</li>
<li>消息最终会被删除，默认一周</li>
</ul>
<h3 id="411zookeeper">4.11zookeeper</h3>
<ul>
<li>kafka通过zookeeper 来存储集群的meta信息</li>
</ul>
<p>zookeeper 谁的事务领先就选择谁来作为新的主节点</p>
<h2 id="5">5数据检索机制</h2>
<ul>
<li>
<p>topic在物理层面以partition作为分组，一个topic可以分成若干个partition</p>
</li>
<li>
<p>partition还可以细分为Segment，一个partition在物理上有多个segment组成</p>
</li>
<li>
<p>segment的参数主要有两个：</p>
<ul>
<li>log.segment.bytes：单个segment最大可以容纳的数据量，默认1GB</li>
<li>log.segment.ms: kafaka在commit一个没写满的segment，等待时间是7天</li>
</ul>
</li>
<li>
<p>LogSegment文件由两部分组成，分别是.index 和.log文件，分别表示segment索引文件和数据文件。</p>
</li>
<li>
<p>partition全局的第一个segment从0开始，后续每个segment文件名为上一个segment文件最后一条消息的offset值</p>
</li>
<li>数值大小为64位，20个字符长度，没有数字的用0填充</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># the first segment</span>
<span class="m">00000000000000000000</span>.index
<span class="m">00000000000000000000</span>.log
<span class="c1"># the second segment</span>
<span class="m">00000000000000170410</span>.index
<span class="m">00000000000000170410</span>.log
</code></pre></div>
<h2 id="6">6数据安全性</h2>
<p>三种模式</p>
<ul>
<li>0， at least once， 消息绝对不会丢，但是可能会重复传输</li>
<li>1，at most once，消息绝对可能会丢，但是绝对不会再次传输</li>
<li>2，exactly once，每条消息肯定会被传输一次且仅传输一次</li>
</ul>
<h3 id="61producer-deliver-guarantee">6.1Producer deliver guarantee</h3>
<p>acks：</p>
<ol>
<li>在isr中的leader 确认后发送一批消息</li>
<li>无需等待broker的回应，发送下一批消息</li>
<li>需要等待所有的follower都接受后才算发送完成，可靠性最高。</li>
</ol>
<h3 id="62-isr-in-sync-replica">6.2 ISR机制 In Sync Replica</h3>
<p>目的是确保数据的一致性，快速的选择新的主节点，来进行数据传输。</p>
<ul>
<li>关键词</li>
<li>AR Assigned Replicas 用来标识副本的全集</li>
<li>OSR out-sync Replicas 离开同步队列的副本</li>
<li>ISR in-sync Replicas 在同步队列中的副本<ul>
<li>ISR = Leader+没有落后太多的follower</li>
<li>AR = ISR+OSR</li>
</ul>
</li>
<li>数据流通过程</li>
<li>Producer -- push &rarr; leader</li>
<li>leader &larr;pull -- follower</li>
<li>follower 间隔时间从leader 拉取数据，保持数据同步</li>
<li>ISR</li>
<li>当主节点挂掉，从ISR中去选择主节点</li>
<li>判断是否在ISR中的标准<ul>
<li>超过10s没有同步数据</li>
<li>replica.lag.time.max.ms =  10000</li>
<li>和leader差4000条数据</li>
<li>replica.lag.max.messages = 4000</li>
</ul>
</li>
<li>脏节点选举<ul>
<li>kafka的一种降级措施</li>
<li>选择第一个恢复的节点作为leader进行服务，并以它的数据作为基准</li>
</ul>
</li>
</ul>
<h3 id="63broker">6.3Broker数据存储机制</h3>
<p>无论消息是否被消费，kafka都会保留所有的消息，在消息策略上有两种可以选择的 </p>
<ol>
<li>基于时间：log.retention.hours=168 # 7days</li>
<li>基于大小: log.retention.bytes=1073741824 # 10GB</li>
</ol>
<h3 id="64">6.4消费者数据消费保证</h3>
<ul>
<li>如果consumer设置为autocommit， consumer一旦读取到数据就进行提交</li>
<li>读完消息先commit，在进行处理</li>
<li>如果处理失败，则无法重新再读取到这个数据。 # <strong>漏读</strong></li>
<li>这对应了at most once</li>
<li>读完消息先处理再commit</li>
<li>如如果处理完之后还没来得及commit，consumer崩溃了，会导致consumer重启后，会把该消息重复处理一次。 # <strong>重复读</strong></li>
<li>这对应了at least once</li>
<li>一定要做到exactly once的，需要协调offset和实际操作的输出</li>
<li>两阶段提交</li>
</ul>
<h2 id="7kafka">7kafka优化</h2>
<h3 id="71partition">7.1partition数目</h3>
<ul>
<li>
<p>一般来说，每一个partition的吞吐量为 几MB/s，增加更多的partition意味着</p>
</li>
<li>
<p>更高的并行和吞吐</p>
</li>
<li>拓展同一个消费者组的消费者数目</li>
<li>如果有很多限制的brokers，则可以利用到brokers</li>
<li>造成更多的zookeeper选举</li>
<li>
<p>kafka打开更多的文件</p>
</li>
<li>
<p>调整策略</p>
</li>
<li>
<p>如果集群较小，则配置2*broker数量的partition数目</p>
</li>
<li>如果集群较大，则配置1*broker数量的partition</li>
<li>考虑最高峰需要吞吐的并行consumer数量，调整partition数量，如果应用场景需要20个consumer进行消费，那么设置成20个partition</li>
</ul>
<h3 id="72replication-factor">7.2replication factor</h3>
<p>决定了副本的数目，更多的副本意味着</p>
<ul>
<li>系统更稳定</li>
<li>更多的延迟</li>
<li>磁盘使用率会更高</li>
</ul>
<p>调整：</p>
<ul>
<li>不要在生产环节中将RF设置为1</li>
<li>如果replication性能成为了瓶颈，使用更好的broker，而不是降低RF的数量</li>
</ul>
<h3 id="73">7.3批量写入</h3>
<p>为了提高吞吐量，需要定期的去批量的写文件</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../../redis/lock/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Redis实现分布式锁锁" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              Redis实现分布式锁锁
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../translate/tp1/" class="md-footer__link md-footer__link--next" aria-label="下一页: 通过漫画-认识Kubernete" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              通过漫画-认识Kubernete
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2022 aschenmaker
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/aschenmaker" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://cqs.es" target="_blank" rel="noopener" title="homepage of me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="m274.69 274.69-37.38-37.38L166 346zM256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm155.85 174.79 14.78-6.13a8 8 0 0 1 10.45 4.34 8 8 0 0 1-4.33 10.46L418 197.57a8 8 0 0 1-10.45-4.33 8 8 0 0 1 4.3-10.45zM314.43 94l6.12-14.78a8 8 0 0 1 10.45-4.3 8 8 0 0 1 4.33 10.45l-6.13 14.78a8 8 0 0 1-10.45 4.33A8 8 0 0 1 314.43 94zM256 60a8 8 0 0 1 8 8v16a8 8 0 0 1-8 8 8 8 0 0 1-8-8V68a8 8 0 0 1 8-8zm-75 14.92a8 8 0 0 1 10.46 4.33L197.57 94a8 8 0 1 1-14.78 6.12l-6.13-14.78A8 8 0 0 1 181 74.92zm-63.58 42.49a8 8 0 0 1 11.31 0L140 128.72a8 8 0 0 1 0 11.28 8 8 0 0 1-11.31 0l-11.31-11.31a8 8 0 0 1 .03-11.28zM60 256a8 8 0 0 1 8-8h16a8 8 0 0 1 8 8 8 8 0 0 1-8 8H68a8 8 0 0 1-8-8zm40.15 73.21-14.78 6.13A8 8 0 0 1 74.92 331a8 8 0 0 1 4.33-10.46L94 314.43a8 8 0 0 1 10.45 4.33 8 8 0 0 1-4.3 10.45zm4.33-136A8 8 0 0 1 94 197.57l-14.78-6.12a8 8 0 0 1-4.3-10.45 8 8 0 0 1 10.45-4.33l14.78 6.13a8 8 0 0 1 4.33 10.44zM197.57 418l-6.12 14.78a8 8 0 0 1-14.79-6.12l6.13-14.78a8 8 0 1 1 14.78 6.12zM264 444a8 8 0 0 1-8 8 8 8 0 0 1-8-8v-16a8 8 0 0 1 8-8 8 8 0 0 1 8 8zm67-6.92a8 8 0 0 1-10.46-4.33L314.43 418a8 8 0 0 1 4.33-10.45 8 8 0 0 1 10.45 4.33l6.13 14.78a8 8 0 0 1-4.34 10.42zm63.58-42.49a8 8 0 0 1-11.31 0L372 383.28a8 8 0 0 1 0-11.28 8 8 0 0 1 11.31 0l11.31 11.31a8 8 0 0 1-.03 11.28zM286.25 286.25 110.34 401.66l115.41-175.91 175.91-115.41zM437.08 331a8 8 0 0 1-10.45 4.33l-14.78-6.13a8 8 0 0 1-4.33-10.45 8 8 0 0 1 10.48-4.32l14.78 6.12a8 8 0 0 1 4.3 10.45zm6.92-67h-16a8 8 0 0 1-8-8 8 8 0 0 1 8-8h16a8 8 0 0 1 8 8 8 8 0 0 1-8 8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "tabs"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../../assets/javascripts/workers/search.01824240.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e0abf5b0.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>